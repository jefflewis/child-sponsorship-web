"use strict";angular.module("childSponsorshipWebApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ui.router","ui.gravatar","angularFileUpload","ui.materialize","stripe.checkout"]).config(["$stateProvider","$urlRouterProvider","$httpProvider","StripeCheckoutProvider",function(a,b,c,d){c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"],d.defaults({key:"pk_test_H6bg1MhKkinX8GVyFFiILbcJ"}),a.state("home",{url:"/",templateUrl:"views/splash.html",controller:"SplashController"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginController"}).state("signup",{url:"/signup",templateUrl:"views/signup.html",controller:"SignupController"}).state("children",{url:"/children",templateUrl:"views/child/index.html",controller:"ChildrenListController",resolve:{childrenResource:"Child",children:["childrenResource",function(a){return a.query()}]}}).state("viewChild",{url:"/children/:id/view",templateUrl:"views/child/view.html",controller:"ChildrenViewController"}).state("newChild",{url:"/children/new",templateUrl:"views/child/new.html",controller:"ChildrenCreateController"}).state("editChild",{url:"/children/:id/edit",templateUrl:"views/child/edit.html",controller:"ChildrenEditController"}).state("sponsorChild",{url:"/sponsor",templateUrl:"views/child/available.html",controller:"ChildrenAvailableContoller"}).state("sponsorChildPayment",{url:"/children/:id/sponsor",templateUrl:"views/child/sponsor.html",controller:"ChildrenSponsorContoller"}).state("addChildImages",{url:"/children/:id/photos",templateUrl:"views/child/addPhotos.html",controller:"ChildrenPhotosController"}).state("users",{url:"/users",templateUrl:"views/user/index.html",controller:"UsersListController",resolve:{usersResource:"User",users:["usersResource",function(a){return a.query()}]}}).state("viewUser",{url:"/users/:id/view",templateUrl:"views/user/view.html",controller:"UsersViewController"}).state("newUser",{url:"/users/new",templateUrl:"views/user/new.html",controller:"UsersCreateController"}).state("editUser",{url:"/users/:id/edit",templateUrl:"views/user/edit.html",controller:"UsersEditController"}).state("userChildren",{url:"/users/:id/children/view",templateUrl:"views/user/children.html",controller:"UsersChildrenController"})}]).run(["$state",function(a){a.go("home")}]),angular.module("childSponsorshipWebApp").directive("input-equals",function(){return{restrict:"A",require:"?ngModel",link:function(a,b,c,d){if(d){a.$watch(c.ngModel,function(){e()}),c.$observe("equals",function(a){e()});var e=function(){var a=d.$viewValue,b=c.equals;d.$setValidity("equals",!a||!b||a===b)}}}}}),angular.module("childSponsorshipWebApp").directive("ngThumb",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas/>",link:function(a,c,d){function e(a){var b=new Image;b.onload=f,b.src=a.target.result}function f(){var a=g.width||this.width/this.height*g.height,b=g.height||this.height/this.width*g.width;h.attr({width:a,height:b}),h[0].getContext("2d").drawImage(this,0,0,a,b)}if(b.support){var g=a.$eval(d.ngThumb);if(b.isFile(g.file)&&b.isImage(g.file)){var h=c.find("canvas"),i=new FileReader;i.onload=e,i.readAsDataURL(g.file)}}}}}]),angular.module("childSponsorshipWebApp").directive("modal",function(){return{restrict:"A",transclude:!0,templateUrl:"views/templates/modal.html",scope:{object:"="},link:function(a,b,c){a.deleteObject=function(a){var b=a.name;a.$delete(function(){Materialize.toast(b+" has been deleted",4e3),window.location.reload()})}}}}),angular.module("childSponsorshipWebApp").factory("authService",["$rootScope","$location","$q","apiService",function(a,b,c,d){var e,f=function(b,c,f,g){d.post(b,{name:c,email:f,password:g}).success(function(b,c,f,g){localStorage.setItem("api-token",b.token),d.get("/user").success(function(b,c,d,f){e=b,localStorage.setItem("email",e.email),localStorage.setItem("access",e.access),a.$broadcast("login.success"),Materialize.toast("Login Successful",4e3)})}).error(function(b,c,d){alert("error: "+c),a.$broadcast("login.failed",d),Materialize.toast("Login Failed",4e3)})},g=function(){return void 0===accessRequired||null===accessRequired||0===accessRequired?!0:void 0!==localStorage.getItem("access")&&localStorage.getItem("access")>=accessRequired},h=function(){d.get("/logout"),localStorage.removeItem("email"),localStorage.removeItem("name"),localStorage.removeItem("access"),localStorage.removeItem("api-token"),a.$broadcast("logout.success")},i=function(a,b){f("/login","name",a,b)},j=function(a,b,c){f("/signup",a,b,c)},k=function(){return localStorage.getItem("email")},l=function(){return!!k()},m=function(){return localStorage.getItem("access")>5?!0:!1},n=function(){return l()?!0:c.reject("Not Authorized")},o=function(){return void 0===e&&d.get("/user").success(function(b,c,d,f){e=b,a.$broadcast("user.success")}),e};return{routeIsAccessible:g,login:i,signup:j,email:k,isLoggedIn:l,isAdmin:m,logout:h,isAuthorized:n,currentUser:o}}]),angular.module("childSponsorshipWebApp").factory("apiService",["$http",function(a){var b="child-sponsorship-web.herokuapp.com"===window.location.host?config.production.api.url:config.development.api.url,c={token:function(){return localStorage.getItem("api-token")}};return c.get=function(d,e){return a.get(b+d+"?token="+c.token(),e)},c["delete"]=function(d,e){return a["delete"](b+d+"?token="+c.token(),e)},c.post=function(d,e,f){var g={};for(var h in e)g[h]=e[h];return g.token=c.token(),a.post(b+d,g,f)},c}]),angular.module("childSponsorshipWebApp").factory("User",["$resource",function(a){var b="child-sponsorship-web.herokuapp.com"===window.location.host?config.production.api.url:config.development.api.url;return a(b+"/users/:id",{id:"@id",token:localStorage.getItem("api-token")},{update:{method:"PUT"}})}]),angular.module("childSponsorshipWebApp").factory("Child",["$resource",function(a){var b="child-sponsorship-web.herokuapp.com"===window.location.host?config.production.api.url:config.development.api.url;return a(b+"/children/:id",{id:"@id",token:localStorage.getItem("api-token")},{update:{method:"PUT"}})}]),angular.module("childSponsorshipWebApp").service("popupService",["$window",function(a){this.showPopup=function(b){return a.confirm(b)}}]),function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):"object"==typeof exports?module.exports=b(require("jquery")):a.bootbox=b(a.jQuery)}(this,function a(b,c){function d(a){var b=q[o.locale];return b?b[a]:q.en[a]}function e(a,c,d){a.stopPropagation(),a.preventDefault();var e=b.isFunction(d)&&d.call(c,a)===!1;e||c.modal("hide")}function f(a){var b,c=0;for(b in a)c++;return c}function g(a,c){var d=0;b.each(a,function(a,b){c(a,b,d++)})}function h(a){var c,d;if("object"!=typeof a)throw new Error("Please supply an object of options");if(!a.message)throw new Error("Please specify a message");return a=b.extend({},o,a),a.buttons||(a.buttons={}),c=a.buttons,d=f(c),g(c,function(a,e,f){if(b.isFunction(e)&&(e=c[a]={callback:e}),"object"!==b.type(e))throw new Error("button with key "+a+" must be an object");e.label||(e.label=a),e.className||(2>=d&&f===d-1?e.className="btn-primary":e.className="btn-default")}),a}function i(a,b){var c=a.length,d={};if(1>c||c>2)throw new Error("Invalid argument length");return 2===c||"string"==typeof a[0]?(d[b[0]]=a[0],d[b[1]]=a[1]):d=a[0],d}function j(a,c,d){return b.extend(!0,{},a,i(c,d))}function k(a,b,c,d){var e={className:"bootbox-"+a,buttons:l.apply(null,b)};return m(j(e,d,c),b)}function l(){for(var a={},b=0,c=arguments.length;c>b;b++){var e=arguments[b],f=e.toLowerCase(),g=e.toUpperCase();a[f]={label:d(g)}}return a}function m(a,b){var d={};return g(b,function(a,b){d[b]=!0}),g(a.buttons,function(a){if(d[a]===c)throw new Error("button key "+a+" is not allowed (options are "+b.join("\n")+")")}),a}var n={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close' data-dismiss='modal' aria-hidden='true'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input bootbox-input-text form-control' autocomplete=off type=text />",textarea:"<textarea class='bootbox-input bootbox-input-textarea form-control'></textarea>",email:"<input class='bootbox-input bootbox-input-email form-control' autocomplete='off' type='email' />",select:"<select class='bootbox-input bootbox-input-select form-control'></select>",checkbox:"<div class='checkbox'><label><input class='bootbox-input bootbox-input-checkbox' type='checkbox' /></label></div>",date:"<input class='bootbox-input bootbox-input-date form-control' autocomplete=off type='date' />",time:"<input class='bootbox-input bootbox-input-time form-control' autocomplete=off type='time' />",number:"<input class='bootbox-input bootbox-input-number form-control' autocomplete=off type='number' />",password:"<input class='bootbox-input bootbox-input-password form-control' autocomplete='off' type='password' />"}},o={locale:"en",backdrop:"static",animate:!0,className:null,closeButton:!0,show:!0,container:"body"},p={};p.alert=function(){var a;if(a=k("alert",["ok"],["message","callback"],arguments),a.callback&&!b.isFunction(a.callback))throw new Error("alert requires callback property to be a function when provided");return a.buttons.ok.callback=a.onEscape=function(){return b.isFunction(a.callback)?a.callback.call(this):!0},p.dialog(a)},p.confirm=function(){var a;if(a=k("confirm",["cancel","confirm"],["message","callback"],arguments),a.buttons.cancel.callback=a.onEscape=function(){return a.callback.call(this,!1)},a.buttons.confirm.callback=function(){return a.callback.call(this,!0)},!b.isFunction(a.callback))throw new Error("confirm requires a callback");return p.dialog(a)},p.prompt=function(){var a,d,e,f,h,i,k;if(f=b(n.form),d={className:"bootbox-prompt",buttons:l("cancel","confirm"),value:"",inputType:"text"},a=m(j(d,arguments,["title","callback"]),["cancel","confirm"]),i=a.show===c?!0:a.show,a.message=f,a.buttons.cancel.callback=a.onEscape=function(){return a.callback.call(this,null)},a.buttons.confirm.callback=function(){var c;switch(a.inputType){case"text":case"textarea":case"email":case"select":case"date":case"time":case"number":case"password":c=h.val();break;case"checkbox":var d=h.find("input:checked");c=[],g(d,function(a,d){c.push(b(d).val())})}return a.callback.call(this,c)},a.show=!1,!a.title)throw new Error("prompt requires a title");if(!b.isFunction(a.callback))throw new Error("prompt requires a callback");if(!n.inputs[a.inputType])throw new Error("invalid prompt type");switch(h=b(n.inputs[a.inputType]),a.inputType){case"text":case"textarea":case"email":case"date":case"time":case"number":case"password":h.val(a.value);break;case"select":var o={};if(k=a.inputOptions||[],!b.isArray(k))throw new Error("Please pass an array of input options");if(!k.length)throw new Error("prompt with select requires options");g(k,function(a,d){var e=h;if(d.value===c||d.text===c)throw new Error("given options in wrong format");d.group&&(o[d.group]||(o[d.group]=b("<optgroup/>").attr("label",d.group)),e=o[d.group]),e.append("<option value='"+d.value+"'>"+d.text+"</option>")}),g(o,function(a,b){h.append(b)}),h.val(a.value);break;case"checkbox":var q=b.isArray(a.value)?a.value:[a.value];if(k=a.inputOptions||[],!k.length)throw new Error("prompt with checkbox requires options");if(!k[0].value||!k[0].text)throw new Error("given options in wrong format");h=b("<div/>"),g(k,function(c,d){var e=b(n.inputs[a.inputType]);e.find("input").attr("value",d.value),e.find("label").append(d.text),g(q,function(a,b){b===d.value&&e.find("input").prop("checked",!0)}),h.append(e)})}return a.placeholder&&h.attr("placeholder",a.placeholder),a.pattern&&h.attr("pattern",a.pattern),a.maxlength&&h.attr("maxlength",a.maxlength),f.append(h),f.on("submit",function(a){a.preventDefault(),a.stopPropagation(),e.find(".btn-primary").click()}),e=p.dialog(a),e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){h.focus()}),i===!0&&e.modal("show"),e},p.dialog=function(a){a=h(a);var c=b(n.dialog),d=c.find(".modal-dialog"),f=c.find(".modal-body"),i=a.buttons,j="",k={onEscape:a.onEscape};if(g(i,function(a,b){j+="<button data-bb-handler='"+a+"' type='button' class='btn "+b.className+"'>"+b.label+"</button>",k[a]=b.callback}),f.find(".bootbox-body").html(a.message),a.animate===!0&&c.addClass("fade"),a.className&&c.addClass(a.className),"large"===a.size?d.addClass("modal-lg"):"small"===a.size&&d.addClass("modal-sm"),a.title&&f.before(n.header),a.closeButton){var l=b(n.closeButton);a.title?c.find(".modal-header").prepend(l):l.css("margin-top","-10px").prependTo(f)}return a.title&&c.find(".modal-title").html(a.title),j.length&&(f.after(n.footer),c.find(".modal-footer").html(j)),c.on("hidden.bs.modal",function(a){a.target===this&&c.remove()}),c.on("shown.bs.modal",function(){c.find(".btn-primary:first").focus()}),"static"!==a.backdrop&&c.on("click.dismiss.bs.modal",function(a){c.children(".modal-backdrop").length&&(a.currentTarget=c.children(".modal-backdrop").get(0)),a.target===a.currentTarget&&c.trigger("escape.close.bb")}),c.on("escape.close.bb",function(a){k.onEscape&&e(a,c,k.onEscape)}),c.on("click",".modal-footer button",function(a){var d=b(this).data("bb-handler");e(a,c,k[d])}),c.on("click",".bootbox-close-button",function(a){e(a,c,k.onEscape)}),c.on("keyup",function(a){27===a.which&&c.trigger("escape.close.bb")}),b(a.container).append(c),c.modal({backdrop:a.backdrop?"static":!1,keyboard:!1,show:!1}),a.show&&c.modal("show"),c},p.setDefaults=function(){var a={};2===arguments.length?a[arguments[0]]=arguments[1]:a=arguments[0],b.extend(o,a)},p.hideAll=function(){return b(".bootbox").modal("hide"),p};var q={bg_BG:{OK:"Ок",CANCEL:"Отказ",CONFIRM:"Потвърждавам"},br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},cs:{OK:"OK",CANCEL:"Zrušit",CONFIRM:"Potvrdit"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},el:{OK:"Εντάξει",CANCEL:"Ακύρωση",CONFIRM:"Επιβεβαίωση"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},et:{OK:"OK",CANCEL:"Katkesta",CONFIRM:"OK"},fa:{OK:"قبول",CANCEL:"لغو",CONFIRM:"تایید"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},he:{OK:"אישור",CANCEL:"ביטול",CONFIRM:"אישור"},hu:{OK:"OK",CANCEL:"Mégsem",CONFIRM:"Megerősít"},hr:{OK:"OK",CANCEL:"Odustani",CONFIRM:"Potvrdi"},id:{OK:"OK",CANCEL:"Batal",CONFIRM:"OK"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},ja:{OK:"OK",CANCEL:"キャンセル",CONFIRM:"確認"},lt:{OK:"Gerai",CANCEL:"Atšaukti",CONFIRM:"Patvirtinti"},lv:{OK:"Labi",CANCEL:"Atcelt",CONFIRM:"Apstiprināt"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},pt:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Confirmar"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},sq:{OK:"OK",CANCEL:"Anulo",CONFIRM:"Prano"},sv:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},th:{OK:"ตกลง",CANCEL:"ยกเลิก",CONFIRM:"ยืนยัน"},tr:{OK:"Tamam",CANCEL:"İptal",CONFIRM:"Onayla"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};return p.addLocale=function(a,c){return b.each(["OK","CANCEL","CONFIRM"],function(a,b){if(!c[b])throw new Error("Please supply a translation for '"+b+"'")}),q[a]={OK:c.OK,CANCEL:c.CANCEL,CONFIRM:c.CONFIRM},p},p.removeLocale=function(a){return delete q[a],p},p.setLocale=function(a){return p.setDefaults("locale",a)},p.init=function(c){return a(c||b)},p}),angular.module("childSponsorshipWebApp").controller("AdminCtrl",["$scope","authService","apiService",function(a,b,c){a.email=b.email(),c.get("/data-only-admins-can-see").success(function(b,c){a.data=b.data})}]),angular.module("childSponsorshipWebApp").controller("LogoutCtrl",["$scope","$location","authService",function(a,b,c){c.logout(),b.path("/").replace()}]),angular.module("childSponsorshipWebApp").controller("HomeCtrl",["$scope","authService","apiService",function(a,b,c){a.email=b.email(),c.get("/data-only-users-can-see").success(function(b,c){a.data=b.data})}]),angular.module("childSponsorshipWebApp").controller("LoginController",["$scope","$state","$rootElement","authService",function(a,b,c,d){a.authenticate=function(){d.login(a.email,a.password)},window.setTimeout(function(){c.find("input").checkAndTriggerAutoFillEvent()},200),a.$root.$on("login.success",function(){b.go("home")}),a.toastPosition={bottom:!0,top:!1,left:!1,right:!1},a.getToastPosition=function(){return Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")},a.showSimpleToast=function(){$mdToast.show($mdToast.simple().content("").position(a.getToastPosition()).hideDelay(0))}}]),angular.module("childSponsorshipWebApp").controller("SignupController",["$scope","$rootScope","$state","$rootElement","authService",function(a,b,c,d,e){a.submitForAuthentication=function(b,c,d,f){a.password===a.passwordConfirm?e.signup(b,c,d):(a.form.email.$invalid&&Materialize.toast("Invalid email address",4e3),d!==f&&Materialize.toast("Passwords do not match",4e3))},a.$on("login.success",function(a,b){c.go("home")}),a.$on("login.failed",function(b,c){a.error=c,console.info("error: ",c)}),window.setTimeout(function(){d.find("input").checkAndTriggerAutoFillEvent()},200)}]),angular.module("childSponsorshipWebApp").controller("SplashController",["$scope","apiService","authService",function(a,b,c){a.$on("login.success",function(){a.isLoggedIn=c.isLoggedIn(),a.user=c.currentUser()}),a.$on("user.success",function(){a.isLoggedIn=c.isLoggedIn(),a.user=c.currentUser()})}]),angular.module("childSponsorshipWebApp").controller("UsersListController",["$scope","$state","popupService","$window","User",function(a,b,c,d,e){a.users=e.query(),$(".modal-trigger").leanModal(),a.openModal=function(b){$("#modal").openModal(),a.currentUser=b},a.closeModal=function(){$("#modal").closeModal()}}]).controller("UsersViewController",["$scope","$stateParams","User",function(a,b,c){a.user=c.get({id:b.id}),a.user.$promise.then(function(b){b.children;a.children=JSON.parse(b.children)})}]).controller("UsersCreateController",["$scope","$rootScope","$state","$stateParams","User",function(a,b,c,d,e){a.user=new e,a.addUser=function(){a.user.$save(function(){b.$broadcast("user.created"),c.go("users")})}}]).controller("UsersEditController",["$scope","$rootScope","$state","$stateParams","User","authService",function(a,b,c,d,e,f){a.updateUser=function(){a.user.$update(function(){b.$broadcast("user.updated"),f.isAdmin()?c.go("users"):c.go("home")})},a.loadUser=function(){a.user=e.get({id:d.id})},a.loadUser()}]).controller("UsersChildrenController",["$scope","$state","$stateParams","User",function(a,b,c,d){Materialize.fadeInImage(".img"),a.user=d.get({id:c.id}),a.user.$promise.then(function(b){b.children;a.children=JSON.parse(b.children)})}]),angular.module("childSponsorshipWebApp").controller("ChildrenListController",["$scope","$state","popupService","$window","Child",function(a,b,c,d,e){a.children=e.query(),$(".modal-trigger").leanModal(),$(".materialboxed").materialbox(),Materialize.fadeInImage(".img"),a.openModal=function(b){$("#modal").openModal(),a.currentChild=b},a.closeModal=function(){$("#modal").closeModal()},a.$on("child.deleted",function(a,c){b.reload()})}]).controller("ChildrenViewController",["$scope","$stateParams","Child",function(a,b,c){a.child=c.get({id:b.id})}]).controller("ChildrenCreateController",["$scope","$state","popupService","$stateParams","Child","apiService",function(a,b,c,d,e,f){a.child=new e,a.$on("$viewContentLoaded",function(){$("textarea#description").characterCounter(),Materialize.fadeInImage(".img")}),a.datepicker=function(){$(".datepicker").pickadate({selectMonths:!0,selectYears:25})},a.addChild=function(){a.child.$save(function(a){b.go("viewChild",{id:a.id})})}}]).controller("ChildrenEditController",["$scope","$state","$stateParams","Child",function(a,b,c,d){a.$on("$viewContentLoaded",function(){$(".materialize-textarea").characterCounter()}),a.updateChild=function(){a.child.$update(function(){b.go("children")})},a.datepicker=function(){$(".datepicker").pickadate({selectMonths:!0,selectYears:25})},a.loadChild=function(){a.child=d.get({id:c.id})},a.loadChild()}]).controller("ChildrenPhotosController",["$scope","$http","$state","$stateParams","Child","FileUploader","apiService",function(a,b,c,d,e,f,g){a.uploader=new f(g.get("/signed_url").success(function(b,c,d,e){a.signed_form=b,a.uploader.url=a.signed_form.url,a.uploader.withCredentials=!0,a.uploader.autoUpload=!0,a.uploader.removeAfterUpload=!0})),a.child=e.get({id:d.id});var h=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+a()+a()+a()+a()+a()+a()};h();a.upload=function(c){b({method:"POST",url:a.signed_form.url,headers:{"Content-Type":"multipart/form-data"},data:c._file})},a.setFormData=function(b){b.formData[0]={key:"uploads//"+a.child.name+"-"+a.child.id+"/"+h()+b._file.name,AWSAccessKeyId:a.signed_form.access_id,acl:a.signed_form.acl,policy:a.signed_form.policy,signature:a.signed_form.signature,"Content-Type":null===b._file.type||""===b._file.type?"application/octet-stream":b._file.type,filename:b._file.name,success_action_status:"201"}},a.uploader.onAfterAddingFile=function(b){b.index=a.uploader._nextIndex-1,console.info("onAfterAdding",b)},a.uploader.onBeforeUploadItem=function(b){a.setFormData(b),console.info("onBeforeUploadItem",b)},a.uploader.onAfterAddingAll=function(b){console.info("onAfterAddingAll",b);for(var c in b)a.setFormData(b[c]),console.info("onAfterAddingAll.fileItem",c)},a.uploader.onSuccessItem=function(b,c,d,e){console.info("onSuccessItem",c);var f=$.parseXML(c),h=$(f),i=h.find("Location").text();g.post("/children/"+a.child.id+"/photos/new",{url:i,caption:"test"}).success(function(a,b,c,d){Materialize.toast("Upload Successfull!")}).error(function(a){Materialize.toast("Error uploading image")})},a.uploader.onErrorItem=function(a,b,c,d){console.info("onErrorItem",a,b,c,d),Materialize.toast("Error uploading image - "+a)},a.uploader.onCompleteItem=function(a,b,c,d){}}]).controller("ChildrenAvailableContoller",["$scope","$state","$stateParams","Child","apiService","authService","StripeCheckout",function(a,b,c,d,e,f,g){e.get("/children/available").success(function(b,c,d,e){a.available=b,Materialize.fadeInImage(".img")}).error(function(a,b){alert("error: "+b),$rootScope.$broadcast("children.available.failed",error)}),a.sponsor=function(a){var c=f.currentUser(),d=g.configure({image:"images/default.png",email:c.email,token:function(d){e.post("/charge",{stripeToken:d,child_id:a.id,user_id:c.id}).success(function(c,d,e,f){Materialize.toast(a.name+" has been sponsored!",4e3),b.reload()}).error(function(a,c){Materialize.toast("Error with payment: "+a+" - "+c,4e3),b.reload()})}});d.open({name:"Child Sponsorship",description:a.name+" — "+a.description,"panel-label":"Sponsor — $35"}),$(window).on("popstate",function(){d.close()})}}]);var config=config||{};config.development={app:"child-sponsorship-web-development",api:{url:"http://localhost:5000/api/v1"}},config.production={app:"child-sponsorship-web",api:{url:"https://child-sponsorship-api.herokuapp.com/api/v1"}},function(a){function b(){var a,b;for(a=0;a<this.length;a++)b=this[a],c(b)||(d(b),i(b))}function c(a){"$$currentValue"in a||(a.$$currentValue=a.getAttribute("value"));var b=a.value,c=a.$$currentValue;return b||c?b===c:!0}function d(a){a.$$currentValue=a.value}function e(b){var c=a.jQuery||a.angular.element,d=c.prototype,e=d.val;d.val=function(a){var c=e.apply(this,arguments);return arguments.length>0&&h(this,function(c){b(c,a)}),c}}function f(a,b){function c(a){var c=a.target;b(c)}k.addEventListener(a,c,!0)}function g(a){for(;a;){if("FORM"===a.nodeName)return j(a);a=a.parentNode}return j()}function h(a,b){if(a.forEach)return a.forEach(b);var c;for(c=0;c<a.length;c++)b(a[c])}function i(b){var c=a.document,d=c.createEvent("HTMLEvents");d.initEvent("change",!0,!0),b.dispatchEvent(d)}var j=a.jQuery||a.angular.element,k=a.document.documentElement,l=j(k);f("change",d),e(d),j.prototype.checkAndTriggerAutoFillEvent=b,f("blur",function(b){a.setTimeout(function(){g(b).find("input").checkAndTriggerAutoFillEvent()},20)}),a.document.addEventListener("DOMContentLoaded",function(){h(document.getElementsByTagName("input"),d),a.setTimeout(function(){l.find("input").checkAndTriggerAutoFillEvent()},200)},!1)}(window),angular.module("childSponsorshipWebApp").directive("navbar",function(){return{templateUrl:"/views/templates/navbar.html",restrict:"E",link:function(a,b,c){},controller:["$scope","$state","authService",function(a,b,c){a.$on("$viewContentLoaded",function(){$(".button-collapse").sideNav(),$(".dropdown-button").dropdown(),a.isLoggedIn=c.isLoggedIn(),a.isAdmin=c.isAdmin(),a.user=c.currentUser()}),a.$on("user.success",function(){a.isLoggedIn=c.isLoggedIn(),a.isAdmin=c.isAdmin(),a.user=c.currentUser()}),a.$on("login.success",function(){a.isLoggedIn=c.isLoggedIn(),a.isAdmin=c.isAdmin(),a.user=c.currentUser()}),a.$on("logout.success",function(){a.isLoggedIn=c.isLoggedIn(),a.isAdmin=c.isAdmin(),a.user=c.currentUser(),b.go("home"),b.reload()}),a.logout=function(){c.logout(),b.go("home"),b.reload()},a.children=function(){b.go("children")},a.sponsor=function(){b.go("sponsorChild")},a.home=function(){b.go("home")},a.users=function(){b.go("users")},a.userChildren=function(){b.go("userChildren")}}]}});