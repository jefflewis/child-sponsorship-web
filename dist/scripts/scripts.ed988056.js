"use strict";angular.module("childSponsorshipWebApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ngTouch","ngRoute"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/splash.html",controller:"SplashCtrl",accessRequired:null,title:"Child Sponsorship"}).when("/auth/login",{templateUrl:"views/login.html",controller:"LoginCtrl",accessRequired:null,title:"Child Sponsorship - Login"}).when("/auth/logout",{template:"",controller:"LogoutCtrl",accessRequired:1,title:"Child Sponsorship - Logout"}).when("/home",{templateUrl:"views/home.html",controller:"HomeCtrl",accessRequired:1,title:"Child Sponsorship - Home"}).when("/admin",{templateUrl:"views/admin.html",controller:"AdminCtrl",accessRequired:9,title:"Child Sponsorship - Admin"}).when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl",accessRequired:null,title:"Child Sponsorship - Sign up"}).otherwise({redirectTo:"/signup",accessRequired:null,title:"Child Sponsorship"})}]).run(["$rootScope","$location","authService",function(a,b,c){a.$on("$routeChangeSuccess",function(a,d,e){c.routeIsAccessible(d.$$route.accessRequired)?b.path(d.$$route.originalPath).replace():c.loggedIn()?(alert("Not authorized."),b.path(e.$$route.originalPath).replace()):(localStorage.setItem("post-login-path",d.$$route.originalPath),b.path("/auth/login").replace())})}]),angular.module("childSponsorshipWebApp").factory("authService",["$window","$location","apiService",function(a,b,c){return{routeIsAccessible:function(a){return void 0===a||null==a||0==a?!0:void 0!==localStorage.getItem("access")&&localStorage.getItem("access")>=a},checkCredentials:function(a,d){console.log(a),console.log(d),c.post("/login",{email:a,password:d}).success(function(a,d,e,f){localStorage.setItem("api-token",a.token),c.get("/user").success(function(a,c,d,e){localStorage.setItem("email",a.email),localStorage.setItem("access",a.access),b.path(localStorage.getItem("post-login-path")||"/home").replace()})}).error(function(a,b){alert("error: "+b)})},email:function(){return localStorage.getItem("email")},loggedIn:function(){return!!this.email()},logOut:function(){c["delete"]("/login"),localStorage.removeItem("email"),localStorage.removeItem("access"),localStorage.removeItem("api-token")}}}]),angular.module("childSponsorshipWebApp").factory("apiService",["$http",function(a){var b=config.production.api.url,c={token:function(){return localStorage.getItem("api-token")}};return c.get=function(d,e){return a.get(b+d+"?token="+c.token(),e)},c["delete"]=function(d,e){return a["delete"](b+d+"?token="+c.token(),e)},c.post=function(d,e,f){var g={};for(var h in e)g[h]=e[h];return g.token=c.token(),a.post(b+d,g,f)},c}]),angular.module("childSponsorshipWebApp").controller("AdminCtrl",["$scope","authService","apiService",function(a,b,c){a.email=b.email(),c.get("/data-only-admins-can-see").success(function(b,c){a.data=b.data})}]),angular.module("childSponsorshipWebApp").controller("LoginCtrl",["$scope","$rootElement","authService",function(a,b,c){a.authenticate=function(){c.checkCredentials(a.email,a.password)},window.setTimeout(function(){b.find("input").checkAndTriggerAutoFillEvent()},200)}]),angular.module("childSponsorshipWebApp").controller("LogoutCtrl",["$scope","$location","authService",function(a,b,c){c.logOut(),b.path("/").replace()}]),angular.module("childSponsorshipWebApp").controller("HomeCtrl",["$scope","authService","apiService",function(a,b,c){a.email=b.email(),c.get("/data-only-users-can-see").success(function(b,c){a.data=b.data})}]),angular.module("childSponsorshipWebApp").controller("SignupCtrl",["$scope","$state","authService",function(a,b,c){a.submitted=!1,a.submit=function(b,d,e){if(a.submitted=!0,a.form.$valid&&d==e)c.signup(a.email,a.password);else{var f="";a.form.email.$invalid&&(f+="Invalid email address"),d!=e&&(f+=""==f?f:", ",f+="Passwords do not match"),a.error={message:f}}},a.toastPosition={bottom:!1,top:!0,left:!0,right:!0},a.getToastPosition=function(){return Object.keys(a.toastPosition).filter(function(b){return a.toastPosition[b]}).join(" ")},a.showSimpleToast=function(){$mdToast.show($mdToast.simple().content("").position(a.getToastPosition()).hideDelay(6e3))},a.$root.$on("signup.success",function(b,c){a.$apply(function(){$location.path("/login")})}),a.$root.$on("signup.failed",function(b,c){a.$apply(function(){a.error=c})})}]),angular.module("childSponsorshipWebApp").controller("SplashCtrl",["$scope","apiService","authService",function(a,b,c){a.loggedIn=c.loggedIn(),b.get("/data-only-users-can-see").success(function(b,c){a.userData=b.data}),b.get("/data-only-admins-can-see").success(function(b,c){a.adminData=b.data})}]);var config=config||{};config.development={app:"child-sponsorship-web-development",api:{url:"http://localhost:5000/api/v1"}},config.production={app:"child-sponsorship-web",api:{url:"http://child-sponsorship-api.herokuapp.com/api/v1"}};